<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Car Demand Forecast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body class="bg-gray-100 p-6">
    <div class="max-w-2xl mx-auto bg-white p-4 rounded shadow">
        <h1 class="text-xl font-bold mb-4">Forecast Dashboard</h1>

        <div class="mb-4">
            <input id="model" class="border p-2 w-full mb-2"
                placeholder="Car models (comma-separated, e.g., Camry,Civic) upto 3 models">

            <input id="region" class="border p-2 w-full" placeholder="Region (e.g., Toronto)">
            <button onclick="getForecast()" class="bg-blue-500 text-white px-4 py-2 mt-2">Get Forecast</button>
        </div>

        <table class="w-full mt-4 text-sm text-left">
            <thead>
                <tr>
                    <th>Month</th>
                    <th>Predicted Sales</th>
                </tr>
            </thead>
            <tbody id="forecast-table" class="text-gray-700"></tbody>
        </table>
        <canvas id="forecastChart" class="mt-6 w-full max-w-xl"></canvas>

    </div>

    <script>
        let chart;

        async function getForecast() {
            const region = document.getElementById("region").value;
            const models = document.getElementById("model").value.split(',').map(m => m.trim());

            const table = document.getElementById("forecast-table");
            table.innerHTML = "";

            const datasets = [];
            const labelsSet = new Set();

            for (const model of models) {
                const res = await fetch("http://localhost:8000/forecast", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ model, region })
                });

                const data = await res.json();

                if (data.error) {
                    const row = document.createElement("tr");
                    row.innerHTML = `<td colspan="2">${model} â†’ ${data.error}</td>`;
                    table.appendChild(row);
                    continue;
                }

                // Fill the table for each model (optional)
                data.forEach(row => {
                    const tr = document.createElement("tr");
                    tr.innerHTML = `<td>${row.Month}</td><td>${row.Predicted}</td>`;
                    table.appendChild(tr);
                    labelsSet.add(row.Month);
                });

                datasets.push({
                    label: model,
                    data: data.map(d => d.Predicted),
                    backgroundColor: randomColor(),
                    borderWidth: 1
                });
            }

            const labels = Array.from(labelsSet).sort();

            // Destroy old chart
            if (chart) chart.destroy();

            const ctx = document.getElementById("forecastChart").getContext("2d");
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: `Forecast Comparison in ${region}`
                        }
                    }
                }
            });
        }

        // Random pastel colors for each model
        function randomColor() {
            const r = Math.floor(100 + Math.random() * 155);
            const g = Math.floor(100 + Math.random() * 155);
            const b = Math.floor(100 + Math.random() * 155);
            return `rgba(${r}, ${g}, ${b}, 0.6)`;
        }
    </script>


</body>

</html>